--VISTA A
--DROP VIEW VISTA_A;
CREATE VIEW VISTA_A AS
SELECT MAX(PRECO_CV) AS PRECO_MAXIMO, MIN(PRECO_CV) AS PRECO_MINIMO, ROUND(((MAX(PRECO_CV)-MIN(PRECO_CV))/MIN(PRECO_CV) * 100),2) AS VARIACAO_PERCENTUAL
FROM PRODUTO, ANUNCIO
WHERE DATA_FINAL BETWEEN (add_months(trunc(sysdate,'mm'),-1)) AND last_day(add_months(trunc(sysdate,'mm'),-1)) AND (PRODUTO.DESCRICAO LIKE '%Rato Wireless%' OR PRODUTO.DESCRICAO LIKE '%Rato s/fios%' OR PRODUTO.DESCRICAO LIKE '%Rato sem fios%')
AND ANUNCIO.ID_PRODUTO=PRODUTO.ID_PRODUTO;

SELECT * FROM VISTA_A;


--VISTA B
--DROP VIEW VISTA_B;
CREATE VIEW VISTA_B AS
SELECT EXTRACT(MONTH FROM DATA_FINAL) AS MÊS, ID_ANUNCIO AS NUMERO_ANUNCIO
FROM ANUNCIO
WHERE (DATA_FINAL BETWEEN (add_months(trunc(sysdate,'mm'),-1)) AND last_day(add_months(trunc(sysdate,'mm'),-1))) AND (DATA_INICIAL BETWEEN (add_months(trunc(sysdate,'mm'),-1)) AND last_day(add_months(trunc(sysdate,'mm'),-1))) AND ANUNCIO.TIPO_ANUNCIO=1
ORDER BY ID_ANUNCIO;

SELECT * FROM VISTA_B;


--VISTA C
--DROP VIEW VISTA_C;
CREATE VIEW VISTA_C AS
SELECT LEILAO.ID_LEILAO, VENDEDOR.NOME AS VENDEDOR_NOME, PRODUTO.NOME AS TIPO_PRODUTO, LEILAO.DATA_INICIAL AS DATA_INICIO_LEILAO
FROM LEILAO, PRODUTO, VENDEDOR, COMPRADOR
WHERE LEILAO.ID_PRODUTO=PRODUTO.ID_PRODUTO AND LEILAO.ID_VENDEDOR=VENDEDOR.ID_VENDEDOR AND LEILAO.ID_COMPRADOR=COMPRADOR.ID_COMPRADOR AND (PRODUTO.NOME LIKE 'HP%' OR PRODUTO.NOME LIKE 'ASUS%') AND (LEILAO.DATA_INICIAL BETWEEN (add_months(trunc(sysdate,'mm'),-6)) AND last_day(add_months(trunc(sysdate,'mm'),0)))
ORDER BY VENDEDOR.NOME DESC;

SELECT * FROM VISTA_C;


--VISTA D
--DROP VIEW VISTA_D; 
--(Na tabela anúncio tem que meter os ids do destaque à mão)
CREATE VIEW VISTA_D AS
SELECT VENDEDOR.ID_VENDEDOR, VENDEDOR.NOME AS NOME_VENDEDOR, PRODUTO.ID_PRODUTO, PRODUTO.NOME AS NOME_PRODUTO
FROM VENDEDOR, PRODUTO, ANUNCIO
WHERE ANUNCIO.ID_VENDEDOR=VENDEDOR.ID_VENDEDOR AND ANUNCIO.ID_PRODUTO=PRODUTO.ID_PRODUTO AND ANUNCIO.ID_DESTAQUE IS NOT NULL AND (ANUNCIO.DATA_INICIAL BETWEEN (add_months(trunc(sysdate,'mm'),-1)) AND last_day(add_months(trunc(sysdate,'mm'),-1)));

SELECT * FROM VISTA_D;


--VISTA E
--DROP VIEW VISTA_E;
CREATE VIEW VISTA_E AS 
SELECT VENDEDOR.ID_VENDEDOR, ANUNCIO.QUANTIDADE AS VALOR_TOTAL_VENDAS
FROM VENDEDOR, ANUNCIO, PRODUTO
WHERE VENDEDOR.ID_VENDEDOR=ANUNCIO.ID_VENDEDOR AND PRODUTO.ID_PRODUTO=ANUNCIO.ID_PRODUTO AND ANUNCIO.DATA_FINAL IS NOT NULL AND PRODUTO.DESCRICAO LIKE 'Monitor%' AND ANUNCIO.LOCALIZACAO LIKE '%Coimbra' AND (EXTRACT(MONTH FROM ANUNCIO.DATA_FINAL) = EXTRACT(MONTH FROM SYSDATE));

SELECT * FROM VISTA_E;


--VISTA F
--DROP VIEW VISTA_F;
CREATE VIEW VISTA_F AS
SELECT COMPRADOR.ID_COMPRADOR AS ID_CLIENTE, COMPRADOR.NOME AS NOME_CLIENTE, PRODUTO.NOME AS TIPO_PRODUTO
FROM COMPRADOR, ANUNCIO, PRODUTO
WHERE COMPRADOR.ID_COMPRADOR=ANUNCIO.ID_COMPRADOR AND PRODUTO.ID_PRODUTO=ANUNCIO.ID_PRODUTO AND ANUNCIO.DATA_FINAL IS NOT NULL AND ANUNCIO.TIPO_ANUNCIO=1 AND ANUNCIO.QUANTIDADE > 2 AND (ANUNCIO.DATA_FINAL BETWEEN (add_months(trunc(sysdate,'mm'),-3)) AND last_day(add_months(trunc(sysdate,'mm'),0)));

SELECT * FROM VISTA_F;


--VISTA G
DROP VIEW VISTA_G;
CREATE VIEW VISTA_G AS
SELECT *
FROM(SELECT COMPRADOR.ID_COMPRADOR AS ID_CLIENTE, VENDEDOR.ID_VENDEDOR AS ID_FORNECEDOR, ANUNCIO.PRECO_CV AS PRECO_COMPRA, ANUNCIO.DATA_FINAL AS DATA_COMPRA
FROM COMPRADOR, VENDEDOR, ANUNCIO, PRODUTO
WHERE PRODUTO.ID_PRODUTO=ANUNCIO.ID_PRODUTO AND COMPRADOR.ID_COMPRADOR=ANUNCIO.ID_COMPRADOR AND VENDEDOR.ID_VENDEDOR=ANUNCIO.ID_VENDEDOR AND ((PRODUTO.DESCRICAO LIKE '%Smartphone%') OR (PRODUTO.DESCRICAO LIKE '%Android%') OR (PRODUTO.DESCRICAO LIKE '%Iphone%')) AND ANUNCIO.DATA_FINAL IS NOT NULL
ORDER BY DATA_COMPRA DESC)X
WHERE ROWNUM <= 4
ORDER BY X.PRECO_COMPRA ASC;

SELECT * FROM VISTA_G;


--VISTA I
--DROP VIEW VISTA_I;
CREATE VIEW VISTA_I AS
SELECT LEILAO.ID_LEILAO, LEILAO.DATA_INICIAL AS DATA_LEILAO, LEILAO.ID_VENDEDOR AS ID_FORNECEDOR, VENDEDOR.NOME AS NOME_FORNECEDOR
FROM LEILAO, VENDEDOR, PRODUTO
WHERE PRODUTO.NOME LIKE '% IP%' AND LEILAO.ID_VENDEDOR=VENDEDOR.ID_VENDEDOR AND LEILAO.ID_PRODUTO=PRODUTO.ID_PRODUTO AND (LEILAO.DATA_INICIAL BETWEEN (add_months(trunc(sysdate,'mm'),-4)) AND last_day(add_months(trunc(sysdate,'mm'),0)))
ORDER BY LEILAO.DATA_INICIAL;

SELECT * FROM VISTA_I;


--VISTA J
--DROP VIEW VISTA_J;
CREATE VIEW VISTA_J AS
SELECT PRODUTO.NOME AS NOME_PRODUTO, VENDEDOR.NOME AS NOME_VENDEDOR, COMPRADOR.NOME AS NOME_COMPRADOR, LEILAO.PRECO_COMPRA AS PRECO_DE_VENDA, LEILAO.QUANTIDADE, LEILAO.TIPO_PORTES AS TIPO_DE_PORTES_ENVIO
FROM PRODUTO, VENDEDOR, COMPRADOR, LEILAO
WHERE LEILAO.ID_PRODUTO=PRODUTO.ID_PRODUTO AND LEILAO.ID_VENDEDOR=VENDEDOR.ID_VENDEDOR AND LEILAO.ID_COMPRADOR=COMPRADOR.ID_COMPRADOR AND (LEILAO.DATA_FINAL >= TRUNC(SYSDATE-1,'DD'))
ORDER BY LEILAO.PRECO_COMPRA DESC;

SELECT * FROM VISTA_J;


--VISTA L
--DROP VIEW VISTA_L;
CREATE VIEW VISTA_L AS
SELECT VENDEDOR.ID_VENDEDOR, VENDEDOR.NOME AS NOME_VENDEDOR, ANUNCIO.LOCALIZACAO AS CONCELHO
FROM VENDEDOR, LEILAO
WHERE ANUNCIO.ID_VENDEDOR=VENDEDOR.ID_VENDEDOR AND (ANUNCIO.LOCALIZACAO LIKE '%, Coimbra' OR ANUNCIO.LOCALIZACAO LIKE '%, Chaves' OR ANUNCIO.LOCALIZACAO LIKE '%, Porto') AND ANUNCIO.DATA_FINAL IS NOT NULL;



--VISTA M ---> Verificar quantos anúncios cada vendedor criou
--DROP VIEW VISTA_M
CREATE VIEW VISTA_M AS
SELECT VENDEDOR.NOME AS NOME_VENDEDOR, COUNT(ANUNCIO.ID_ANUNCIO) AS ANUNCIOS_CRIADOS
FROM ANUNCIO, VENDEDOR
WHERE ANUNCIO.ID_VENDEDOR=VENDEDOR.ID_VENDEDOR AND ANUNCIO.TIPO_ANUNCIO=0
GROUP BY VENDEDOR.NOME
ORDER BY ANUNCIOS_CRIADOS DESC;

SELECT * FROM VISTA_M;


--VISTA N -->Encontrar o anúncio de venda com o maior preço
--DROP VIEW VISTA_N;
CREATE VIEW VISTA_N AS
SELECT ANUNCIO.ID_ANUNCIO, X.PRECO
FROM(SELECT MAX(ANUNCIO.PRECO_CV) AS PRECO
FROM ANUNCIO
WHERE ANUNCIO.TIPO_ANUNCIO=0)X,ANUNCIO
WHERE ANUNCIO.PRECO_CV=X.PRECO;

SELECT * FROM VISTA_N;